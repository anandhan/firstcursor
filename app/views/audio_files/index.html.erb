<div class="container mx-auto px-4 py-8">
  <h1 class="text-3xl font-bold mb-8">Audio File Browser</h1>

  <div class="mb-8">
    <form action="<%= audio_files_path %>" method="get" class="flex gap-4">
      <input type="text" 
             name="directory_path" 
             value="<%= @directory_path %>" 
             placeholder="Enter directory path" 
             class="flex-1 px-4 py-2 border rounded-lg"
             id="directory-path-display">
      
      <button type="button" 
              class="px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600"
              onclick="document.getElementById('directory-picker').click()">
        Choose Directory
      </button>
      
      <input type="file" 
             id="directory-picker" 
             webkitdirectory 
             directory 
             style="display: none"
             onchange="updateDirectoryPath(this)">
    </form>
  </div>

  <% if @audio_files.any? %>
    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      <% @audio_files.each do |file| %>
        <div class="bg-white rounded-lg shadow-md p-6 hover:shadow-lg transition-shadow">
          <div class="mb-4">
            <h3 class="text-xl font-semibold text-gray-800"><%= file[:name] %></h3>
            <p class="text-sm text-gray-500"><%= file[:size] %></p>
          </div>

          <div class="space-y-2">
            <% if file[:metadata][:title].present? %>
              <p><span class="font-medium">Title:</span> <%= file[:metadata][:title] %></p>
            <% end %>
            
            <% if file[:metadata][:artist].present? %>
              <p><span class="font-medium">Artist:</span> <%= file[:metadata][:artist] %></p>
            <% end %>
            
            <% if file[:metadata][:album].present? %>
              <p><span class="font-medium">Album:</span> <%= file[:metadata][:album] %></p>
            <% end %>
            
            <% if file[:metadata][:year].present? %>
              <p><span class="font-medium">Year:</span> <%= file[:metadata][:year] %></p>
            <% end %>
            
            <% if file[:metadata][:genre].present? %>
              <p><span class="font-medium">Genre:</span> <%= file[:metadata][:genre] %></p>
            <% end %>
          </div>
        </div>
      <% end %>
    </div>
  <% elsif @directory_path.present? %>
    <div class="text-center py-8">
      <p class="text-gray-500">No audio files found in the selected directory.</p>
    </div>
  <% end %>
</div>

<script>
function updateDirectoryPath(input) {
  const pathDisplay = document.getElementById('directory-path-display');
  if (input.files.length > 0) {
    // Get the directory path from the first file
    const path = input.files[0].webkitRelativePath.split('/')[0];
    pathDisplay.value = input.files[0].path.replace(/\\/g, '/').replace('/' + path, '');
    // Submit the form
    input.form.submit();
  }
}
</script>
